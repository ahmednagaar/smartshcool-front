<!-- Main Game Container -->
<div class="game-container" dir="rtl" cdkDropListGroup>

    <!-- Decorative Sparkles Background -->
    <div class="sparkles-bg"></div>

    <!-- Header Section -->
    <header class="game-header">
        <h1 class="game-title">{{ gameData?.question?.gameTitle || 'ูุนุจุฉ ูุทุงุจูุฉ ุงูุจุทุงูุงุช' }}</h1>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar" [style.width.%]="(matchedPairs / totalPairs) * 100"></div>
        </div>

        <!-- Stats & Stars -->
        <div class="flex justify-center items-center gap-8 mb-4">
            <div class="text-white text-lg font-bold">
                <span>ุงูุฒูู: {{ timerSeconds }}s</span>
            </div>
            <div class="star-ratings">
                <span *ngFor="let star of [0,1,2]" class="star" [class.active]="star < stars" role="img">
                    โ
                </span>
            </div>
            <div class="text-white text-lg font-bold">
                <span>ุงูููุงุท: {{ score }}</span>
            </div>
        </div>
    </header>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
        <div class="loading-spinner">๐ฎ</div>
        <p>ุฌุงุฑู ุชุญููู ุงููุนุจุฉ...</p>
    </div>

    <!-- Start Screen (if needed, usually auto-starts) -->
    <div *ngIf="!isLoading && gameState === 'start'" class="start-screen">
        <div class="start-card">
            <div class="start-icon">๐ง</div>
            <h2>ูู ุฃูุช ูุณุชุนุฏุ</h2>
            <p>ุทุงุจู ุงูุฅุฌุงุจุงุช ุจุงูุฃุณุฆูุฉ ุงูุตุญูุญุฉ</p>
            <!-- We usually auto-start, but if not -->
        </div>
    </div>

    <!-- Playing State -->
    <div *ngIf="!isLoading && (gameState === 'playing' || gameState === 'complete')" class="w-full">

        <!-- CLASSIC MODE GRID -->
        <div *ngIf="gameData?.gameMode === FlipCardGameMode.Classic" class="classic-grid">
            <div *ngFor="let card of cards" class="memory-card" [class.flipped]="card.isFlipped || card.isMatched"
                [class.matched]="card.isMatched" [class.shake]="card.shake" (click)="flipCard(card)">

                <div class="memory-face card-front">
                    <!-- Content -->
                    <div *ngIf="card.type === FlipCardContentType.Text" class="text-xl font-bold text-center p-2">{{
                        card.text }}</div>
                    <div *ngIf="card.type === FlipCardContentType.Image">
                        <img [src]="card.imageUrl" alt="Card Image" class="max-w-full max-h-full">
                        <p *ngIf="card.text" class="text-sm mt-2">{{ card.text }}</p>
                    </div>
                    <div *ngIf="card.type === FlipCardContentType.Audio">
                        <span class="text-2xl">๐</span>
                        <p>Listen</p>
                    </div>
                </div>

                <div class="memory-face card-back">
                    <span>?</span>
                </div>
            </div>
        </div>

        <!-- MATCH MODE GRID -->
        <div *ngIf="gameData?.gameMode === FlipCardGameMode.Match" class="game-grid">

            <!-- RIGHT SECTION (Questions/Targets in RTL layou, but functionally drag SOURCE to TARGET) -->
            <!-- In our logic: Drag Left (Answer) to Right (Question). -->
            <!-- Visual RTL: Right is first? Grid layout: 1fr auto 1fr. -->
            <!-- Let's put Answers on Right (Source) and Questions on Left (Target) for RTL flow? -->
            <!-- Traditionally RTL: Flow is Right to Left. So Source on Right? -->
            <!-- Let's stick to logical columns. -->

            <!-- Answers Column (Source) -->
            <section class="game-section answers-section">
                <h2 class="section-title">ุงูุฅุฌุงุจุงุช</h2>
                <div class="cards-container">
                    <div *ngFor="let card of leftCards" class="card-wrapper">
                        <div *ngIf="!card.isMatched" cdkDrag [cdkDragData]="card"
                            class="flip-card answer-card draggable">

                            <div class="flip-card-inner">
                                <div class="flip-card-front">
                                    <!-- Content -->
                                    <div *ngIf="card.type === FlipCardContentType.Text" class="text-lg font-bold">{{
                                        card.text }}</div>
                                    <div *ngIf="card.type === FlipCardContentType.Image">
                                        <img [src]="card.imageUrl" class="h-16 object-contain">
                                    </div>
                                    <div class="drag-hint">ุงุณุญุจูู!</div>
                                </div>
                            </div>

                            <!-- Preview -->
                            <div *cdkDragPreview class="drag-preview">
                                <span>{{ card.text || 'Image' }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Divider -->
            <div class="center-divider">
                <div class="divider-line"></div>
            </div>

            <!-- Questions Column (Target) -->
            <section class="game-section questions-section">
                <h2 class="section-title">ุงูุฃุณุฆูุฉ</h2>
                <div class="cards-container">
                    <div *ngFor="let card of rightCards" class="card-wrapper" cdkDropList [cdkDropListData]="card"
                        (cdkDropListDropped)="onDrop($event, card)">

                        <div class="flip-card question-card" [class.matched]="card.isMatched" [class.shake]="card.shake"
                            [class.celebrate]="card.celebrate">

                            <div class="flip-card-inner">
                                <div class="flip-card-front">
                                    <div *ngIf="card.type === FlipCardContentType.Text" class="text-lg font-bold">{{
                                        card.text }}</div>
                                    <div *ngIf="card.type === FlipCardContentType.Image">
                                        <img [src]="card.imageUrl" class="h-16 object-contain">
                                    </div>

                                    <div *ngIf="card.isMatched" class="match-badge">โ</div>
                                    <div *ngIf="!card.isMatched" class="drop-hint">ุถุน ุงูุฅุฌุงุจุฉ ููุง</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

    </div>

    <!-- Victory Modal -->
    <div *ngIf="gameState === 'complete'" class="victory-overlay">
        <div class="victory-modal">
            <div class="victory-icon">๐</div>
            <h2>ุฃุญุณูุช!</h2>
            <p>ุฃูููุช ุงููุนุจุฉ ุจูุฌุงุญ!</p>

            <div class="stats">
                <div class="stat">
                    <span class="stat-value">{{ score }}</span>
                    <span class="stat-label">ููุงุท</span>
                </div>
                <div class="stat">
                    <span class="stat-value">{{ timerSeconds }}s</span>
                    <span class="stat-label">ุซุงููุฉ</span>
                </div>
            </div>

            <button class="replay-button" (click)="playAgain()">
                ุงูุนุจ ูุฑุฉ ุฃุฎุฑู ๐
            </button>
            <button class="exit-button" (click)="exit()">
                ุฎุฑูุฌ
            </button>
        </div>
    </div>
</div>