<div class="list-container" dir="rtl">

    <!-- Toast -->
    <div *ngIf="toastVisible" class="toast-notification" [class]="'toast-' + toastType">
        <span class="toast-text">{{ toastMessage }}</span>
    </div>

    <!-- Header -->
    <div class="list-header">
        <div>
            <h1 class="list-title">๐ด ุฃูุนุงุจ ุงูุจุทุงูุงุช</h1>
            <p class="list-subtitle">
                ุฅุฏุงุฑุฉ ุฃูุนุงุจ ุงูุฐุงูุฑุฉ ูุงููุทุงุจูุฉ
                <span *ngIf="filteredQuestions.length > 0" class="question-count">
                    ({{ filteredQuestions.length }} ูุนุจุฉ)
                </span>
            </p>
        </div>
        <a routerLink="./new" class="create-btn">
            <lucide-icon name="plus" class="w-5 h-5"></lucide-icon>
            ุฅุถุงูุฉ ูุนุจุฉ ุฌุฏูุฏุฉ
        </a>
    </div>

    <!-- Filters -->
    <div class="filters-bar">
        <div class="filter-group search-group">
            <label class="filter-label">ุงูุจุญุซ</label>
            <div class="search-wrapper">
                <lucide-icon name="search" class="search-icon w-4 h-4"></lucide-icon>
                <input type="text" [(ngModel)]="searchTerm" (input)="onSearch()" placeholder="ุงุจุญุซ ุจุงูุนููุงู..."
                    class="search-input">
            </div>
        </div>

        <div class="filter-group">
            <label class="filter-label">ุงูุตู</label>
            <select [(ngModel)]="selectedGrade" (change)="onFilterChange()" class="filter-select">
                <option [ngValue]="null">ุฌููุน ุงูุตููู</option>
                <option [ngValue]="GradeLevel.Grade3">ุงูุตู ุงูุซุงูุซ</option>
                <option [ngValue]="GradeLevel.Grade4">ุงูุตู ุงูุฑุงุจุน</option>
                <option [ngValue]="GradeLevel.Grade5">ุงูุตู ุงูุฎุงูุณ</option>
                <option [ngValue]="GradeLevel.Grade6">ุงูุตู ุงูุณุงุฏุณ</option>
            </select>
        </div>

        <div class="filter-group">
            <label class="filter-label">ุงููุงุฏุฉ</label>
            <select [(ngModel)]="selectedSubject" (change)="onFilterChange()" class="filter-select">
                <option [ngValue]="null">ุฌููุน ุงูููุงุฏ</option>
                <option [ngValue]="SubjectType.Arabic">ุงููุบุฉ ุงูุนุฑุจูุฉ</option>
                <option [ngValue]="SubjectType.Math">ุงูุฑูุงุถูุงุช</option>
                <option [ngValue]="SubjectType.Science">ุงูุนููู</option>
            </select>
        </div>

        <div class="filter-refresh">
            <button (click)="loadQuestions()" class="refresh-btn">๐ ุชุญุฏูุซ</button>
        </div>
    </div>

    <!-- Table -->
    <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>ุงูุนููุงู</th>
                    <th>ุงูุตู ูุงููุงุฏุฉ</th>
                    <th>ุงูููุน</th>
                    <th>ุงูุฃุฒูุงุฌ</th>
                    <th>ุงูุตุนูุจุฉ</th>
                    <th>ุงูุญุงูุฉ</th>
                    <th class="actions-th">ุงูุฅุฌุฑุงุกุงุช</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let q of filteredQuestions" class="data-row">
                    <td>
                        <div class="title-cell">
                            <div class="game-title">{{ q.gameTitle }}</div>
                            <div class="game-instructions">{{ q.instructions }}</div>
                        </div>
                    </td>
                    <td>
                        <div class="grade-subject">
                            <span class="subject-name">{{ getSubjectName(q.subjectId) }}</span>
                            <span class="grade-name">{{ getGradeName(q.gradeId) }}</span>
                        </div>
                    </td>
                    <td>
                        <span class="mode-badge">{{ getModeName(q.gameMode) }}</span>
                    </td>
                    <td>
                        <span class="pairs-badge">{{ q.numberOfPairs }} ุฒูุฌ</span>
                    </td>
                    <td>
                        <span class="difficulty-badge" [style.color]="getDifficultyColor(q.difficultyLevel)">
                            {{ getDifficultyBadge(q.difficultyLevel) }}
                        </span>
                    </td>
                    <td>
                        <button (click)="toggleActive(q)" class="status-toggle" [class.active]="q.isActive"
                            [class.draft]="!q.isActive" [title]="q.isActive ? 'ุงุถุบุท ูุฅููุงู' : 'ุงุถุบุท ูุชูุนูู'">
                            {{ q.isActive ? '๐ข ูุดุท' : 'โซ ูุณูุฏุฉ' }}
                        </button>
                    </td>
                    <td class="actions-cell">
                        <!-- Normal actions -->
                        <div *ngIf="deleteConfirmId !== q.id" class="actions-row">
                            <a [routerLink]="['./edit', q.id]" class="action-btn edit" title="ุชุนุฏูู">
                                <lucide-icon name="edit" class="w-4 h-4"></lucide-icon>
                            </a>
                            <button (click)="duplicateQuestion(q)" class="action-btn copy" title="ูุณุฎ">
                                <lucide-icon name="copy" class="w-4 h-4"></lucide-icon>
                            </button>
                            <button (click)="confirmDelete(q.id)" class="action-btn delete" title="ุญุฐู">
                                <lucide-icon name="trash-2" class="w-4 h-4"></lucide-icon>
                            </button>
                        </div>

                        <!-- Inline delete confirmation -->
                        <div *ngIf="deleteConfirmId === q.id" class="delete-confirm">
                            <span class="confirm-text">ุญุฐูุ</span>
                            <button (click)="deleteQuestion(q.id)" class="confirm-yes">ูุนู</button>
                            <button (click)="cancelDelete()" class="confirm-no">ูุง</button>
                        </div>
                    </td>
                </tr>

                <!-- Empty State -->
                <tr *ngIf="filteredQuestions.length === 0 && !loading">
                    <td colspan="7" class="empty-state">
                        <div class="empty-content">
                            <div class="empty-icon">๐ด</div>
                            <p class="empty-title">ูุง ุชูุฌุฏ ุฃูุนุงุจ ุจุทุงูุงุช ูุชุงุญุฉ</p>
                            <p class="empty-desc">ุงุจุฏุฃ ุจุฅูุดุงุก ูุนุจุฉ ุจุทุงูุงุช ุฌุฏูุฏุฉ ููุทูุงุจ</p>
                            <a routerLink="./new" class="create-btn small">
                                <lucide-icon name="plus" class="w-4 h-4"></lucide-icon>
                                ุฅูุดุงุก ูุนุจุฉ ุฌุฏูุฏุฉ
                            </a>
                        </div>
                    </td>
                </tr>

                <!-- Loading -->
                <tr *ngIf="loading">
                    <td colspan="7" class="loading-state">
                        <div class="loading-content">
                            <div class="loading-dots">
                                <span></span><span></span><span></span>
                            </div>
                            <p>ุฌุงุฑู ุงูุชุญููู...</p>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>